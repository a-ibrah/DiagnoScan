{% extends "layout.html" %}
{% block content %}

  <!-- Main Buttons -->
  <div class="d-flex justify-content-center mb-4 gap-3">
    <button id="contribute-btn" class="btn btn-lg action-btn contribute-btn">Contribute to Database</button>
    <button id="predict-btn" class="btn btn-lg action-btn predict-btn">Make Prediction</button>
  </div>

  <!-- File Upload Section -->
  <div id="upload-section" class="mt-4">
    <h3 class="text-center mb-3">Upload Files</h3>

    <form id="upload-form" method="POST" action="{{ url_for('index') }}" enctype="multipart/form-data">
      <div class="d-flex justify-content-center gap-5">
        <!-- Slide Upload -->
        <div class="upload-box text-center" id="slide-box">
          <h5>Pathology Slide</h5>
          <p>Accepted: .jpg, .jpeg, .png, .svs</p>
          <p id="slide-status">No file uploaded</p>
          <input 
            class="form-control" 
            type="file" 
            id="slide-file" 
            name="slide_file" 
            accept=".jpg,.jpeg,.png,.svs" 
            style="display: none;" 
            required
          >
          <button 
            class="btn btn-secondary btn-sm upload-btn" 
            onclick="document.getElementById('slide-file').click();">
            Choose File
          </button>
        </div>

        <!-- PET Scan Upload -->
        <div class="upload-box text-center" id="pet-box">
          <h5>PET Scan</h5>
          <p>Accepted: .dicom</p>
          <p id="pet-status">No file uploaded</p>
          <input 
            class="form-control" 
            type="file" 
            id="pet-file" 
            name="pet_file" 
            accept=".dicom" 
            style="display: none;"
          >
          <button 
            class="btn btn-secondary btn-sm upload-btn" 
            onclick="document.getElementById('pet-file').click();">
            Choose File
          </button>
        </div>

        <!-- CT Scan Upload -->
        <div class="upload-box text-center" id="ct-box">
          <h5>CT Scan</h5>
          <p>Accepted: .dicom</p>
          <p id="ct-status">No file uploaded</p>
          <input 
            class="form-control" 
            type="file" 
            id="ct-file" 
            name="ct_file" 
            accept=".dicom" 
            style="display: none;"
          >
          <button 
            class="btn btn-secondary btn-sm upload-btn" 
            onclick="document.getElementById('ct-file').click();">
            Choose File
          </button>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-4">
        <button id="submit-btn" class="btn btn-primary btn-lg" type="submit" disabled>
          Next
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  const contributeBtn = document.getElementById("contribute-btn");
  const predictBtn = document.getElementById("predict-btn");
  const slideFileInput = document.getElementById("slide-file");
  const petFileInput = document.getElementById("pet-file");
  const ctFileInput = document.getElementById("ct-file");
  const submitBtn = document.getElementById("submit-btn");

  // Update file status on file change
  slideFileInput.addEventListener("change", () => {
    const fileName = slideFileInput.files[0]?.name || "No file uploaded";
    document.getElementById("slide-status").innerText = fileName;
  });

  petFileInput.addEventListener("change", () => {
    const fileName = petFileInput.files[0]?.name || "No file uploaded";
    document.getElementById("pet-status").innerText = fileName;
  });

  ctFileInput.addEventListener("change", () => {
    const fileName = ctFileInput.files[0]?.name || "No file uploaded";
    document.getElementById("ct-status").innerText = fileName;
  });

  // Enable the "Next" button based on file inputs
  const fileInputs = [slideFileInput, petFileInput, ctFileInput];
  fileInputs.forEach((input) => {
    input.addEventListener("change", () => {
      const hasFile = fileInputs.some(input => input.files.length > 0);
      submitBtn.disabled = !hasFile; // Enable only if at least one file is uploaded
    });
  });

  // Button logic remains for enabling/disabling required fields
  contributeBtn.addEventListener("click", () => {
    contributeBtn.classList.add("active");
    predictBtn.classList.remove("active");
    slideFileInput.required = false; // Slide is not required for contributing
  });

  predictBtn.addEventListener("click", () => {
    predictBtn.classList.add("active");
    contributeBtn.classList.remove("active");
    slideFileInput.required = true; // Slide is required for prediction
  });
</script>

<style>
  .upload-box {
    width: 300px; /* Increased width */
    height: 200px; /* Added height for better visibility */
    padding: 20px;
    border: 2px solid #ccc;
    border-radius: 10px;
    background-color: #f9f9f9;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .upload-btn {
    margin-top: 10px;
  }

  /* Center text in status paragraph */
  #slide-status, #pet-status, #ct-status {
    margin: 5px 0;
    font-size: 14px;
    font-style: italic;
  }
</style>

{% endblock %}